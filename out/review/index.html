<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ä¹ é¡µé¢ - å•è¯ä»“åº“</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="font-nunito">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ç›´æ¥ä½¿ç”¨ä¸è¯æ±‡ç®¡ç†é¡µé¢ç›¸åŒçš„æ•°æ®è®¿é—®æ–¹å¼
        const getAllWords = async () => {
            try {
                console.log('å¼€å§‹è·å–å•è¯...');
                
                // è·å–ç”¨æˆ·IDï¼ˆä¸cloudReadyStorage.tsä¸­çš„é€»è¾‘ä¸€è‡´ï¼‰
                const getUserId = () => {
                    const storageKey = 'wordflashcard_user_id';
                    let userId = localStorage.getItem(storageKey);
                    
                    if (!userId) {
                        // ç”ŸæˆåŸºäºæµè§ˆå™¨ç‰¹å¾çš„ç¨³å®šID
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        ctx.textBaseline = 'top';
                        ctx.font = '14px Arial';
                        ctx.fillText('Browser fingerprint', 2, 2);
                        
                        const fingerprint = [
                            navigator.userAgent,
                            navigator.language,
                            screen.width + 'x' + screen.height,
                            new Date().getTimezoneOffset(),
                            canvas.toDataURL()
                        ].join('|');
                        
                        // ç®€å•å“ˆå¸Œå‡½æ•°
                        let hash = 0;
                        for (let i = 0; i < fingerprint.length; i++) {
                            const char = fingerprint.charCodeAt(i);
                            hash = ((hash << 5) - hash) + char;
                            hash = hash & hash;
                        }
                        
                        userId = `user_${Math.abs(hash).toString(36).substring(0, 8)}_${Date.now()}`;
                        localStorage.setItem(storageKey, userId);
                        console.log('ğŸ†” ç”Ÿæˆæ–°ç”¨æˆ·ID:', userId);
                    }
                    
                    return userId;
                };

                const userId = getUserId();
                const userDbName = `wordflashcard_${userId}`;
                const sharedDbName = 'wordflashcard_shared';
                
                console.log('ğŸ” æ£€æŸ¥ç”¨æˆ·æ•°æ®åº“:', userDbName);
                console.log('ğŸ” æ£€æŸ¥å…±äº«æ•°æ®åº“:', sharedDbName);
                
                // å°è¯•æ­£ç¡®çš„æ•°æ®åº“å’Œç‰ˆæœ¬ç»„åˆ
                const dbConfigs = [
                    { name: userDbName, version: 5 },
                    { name: sharedDbName, version: 5 },
                    // ä¿ç•™ä¸€äº›æ—§çš„æ•°æ®åº“åç§°ä½œä¸ºåå¤‡
                    { name: 'WordAppDB', version: 1 },
                    { name: 'WordAppDB', version: 2 },
                    { name: 'SharedImagePool', version: 1 },
                    { name: 'words-db', version: 1 },
                    { name: 'user-db', version: 1 },
                    { name: 'UserDB', version: 1 },
                    { name: 'vocabulary-db', version: 1 }
                ];
                
                const storeNames = ['words', 'word', 'items', 'data', 'userWords', 'vocabulary', 'userData'];
                
                for (const config of dbConfigs) {
                    try {
                        const request = indexedDB.open(config.name, config.version);
                        const db = await new Promise((resolve, reject) => {
                            request.onsuccess = () => resolve(request.result);
                            request.onerror = () => reject(request.error);
                        });
                        
                        console.log(`æ£€æŸ¥æ•°æ®åº“: ${config.name} v${config.version}`);
                        console.log(`å¯ç”¨å­˜å‚¨: ${Array.from(db.objectStoreNames)}`);
                        
                        // å°è¯•æ¯ä¸ªå­˜å‚¨
                        for (const storeName of storeNames) {
                            if (db.objectStoreNames.contains(storeName)) {
                                try {
                                    const transaction = db.transaction([storeName], 'readonly');
                                    const store = transaction.objectStore(storeName);
                                    const getAllRequest = store.getAll();
                                    
                                    const words = await new Promise((resolve, reject) => {
                                        getAllRequest.onsuccess = () => {
                                            const words = getAllRequest.result || [];
                                            console.log(`ä» ${config.name}.${storeName} è·å–åˆ° ${words.length} ä¸ªå•è¯`);
                                            resolve(words);
                                        };
                                        getAllRequest.onerror = () => {
                                            console.log(`ä» ${config.name}.${storeName} è·å–å¤±è´¥`);
                                            resolve([]);
                                        };
                                    });
                                    
                                    if (words.length > 0) {
                                        db.close();
                                        console.log(`æˆåŠŸæ‰¾åˆ°æ•°æ®: ${config.name}.${storeName}`);
                                        return words.filter(word => word && word.word);
                                    }
                                } catch (error) {
                                    console.log(`è®¿é—® ${config.name}.${storeName} å¤±è´¥:`, error);
                                }
                            }
                        }
                        
                        db.close();
                    } catch (error) {
                        console.log(`æ•°æ®åº“ ${config.name} v${config.version} ä¸å­˜åœ¨:`, error);
                    }
                }
                
                console.log('æ²¡æœ‰æ‰¾åˆ°ä»»ä½•å•è¯æ•°æ®');
                return [];
                
            } catch (error) {
                console.error('è·å–å•è¯å¤±è´¥:', error);
                return [];
            }
        };

        // å¤ä¹ é¡µé¢ç»„ä»¶
        const ReviewPage = () => {
            const [words, setWords] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [showTranslation, setShowTranslation] = useState(false);

            useEffect(() => {
                loadWords();
            }, []);

            const loadWords = async () => {
                try {
                    const allWords = await getAllWords();
                    setWords(allWords);
                    setIsLoading(false);
                } catch (error) {
                    console.error('åŠ è½½å•è¯å¤±è´¥:', error);
                    setIsLoading(false);
                }
            };

            const currentWord = words[currentIndex];
            const progress = words.length > 0 ? ((currentIndex + 1) / words.length) * 100 : 0;

            const handleNext = () => {
                if (currentIndex < words.length - 1) {
                    setCurrentIndex(currentIndex + 1);
                    setShowTranslation(false);
                }
            };

            const handlePrevious = () => {
                if (currentIndex > 0) {
                    setCurrentIndex(currentIndex - 1);
                    setShowTranslation(false);
                }
            };

            const handleToggleTranslation = () => {
                setShowTranslation(!showTranslation);
            };

            const handleRestart = () => {
                setCurrentIndex(0);
                setShowTranslation(false);
            };

            if (isLoading) {
                return React.createElement('div', {
                    className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center'
                }, React.createElement('div', {
                    className: 'text-center'
                }, [
                    React.createElement('div', {
                        key: 'spinner',
                        className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4'
                    }),
                    React.createElement('p', {
                        key: 'text',
                        className: 'text-gray-600'
                    }, 'åŠ è½½å•è¯ä¸­...')
                ]));
            }

            if (words.length === 0) {
                return React.createElement('div', {
                    className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100'
                }, [
                    React.createElement('nav', {
                        key: 'nav',
                        className: 'bg-white shadow-sm border-b'
                    }, React.createElement('div', {
                        className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'
                    }, React.createElement('div', {
                        className: 'flex justify-between h-16'
                    }, React.createElement('div', {
                        className: 'flex items-center'
                    }, [
                        React.createElement('h1', {
                            key: 'title',
                            className: 'text-xl font-semibold text-gray-800'
                        }, 'å•è¯ä»“åº“'),
                        React.createElement('div', {
                            key: 'links',
                            className: 'ml-10 flex items-baseline space-x-4'
                        }, [
                            React.createElement('a', {
                                key: 'home',
                                href: '/',
                                className: 'text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium'
                            }, 'é¦–é¡µ'),
                            React.createElement('a', {
                                key: 'manage',
                                href: '/manage',
                                className: 'text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium'
                            }, 'è¯æ±‡ç®¡ç†'),
                            React.createElement('a', {
                                key: 'review',
                                href: '/review',
                                className: 'bg-blue-100 text-blue-700 px-3 py-2 rounded-md text-sm font-medium'
                            }, 'å¤ä¹ ')
                        ])
                    ])))),
                    React.createElement('div', {
                        key: 'content',
                        className: 'max-w-4xl mx-auto p-8'
                    }, React.createElement('div', {
                        className: 'text-center'
                    }, [
                        React.createElement('h1', {
                            key: 'title',
                            className: 'text-3xl font-bold text-gray-800 mb-4'
                        }, 'å¤ä¹ é¡µé¢'),
                        React.createElement('p', {
                            key: 'text',
                            className: 'text-gray-600 mb-8'
                        }, 'æ²¡æœ‰æ‰¾åˆ°å•è¯æ•°æ®ï¼Œè¯·å…ˆæ·»åŠ ä¸€äº›å•è¯ã€‚'),
                        React.createElement('a', {
                            key: 'link',
                            href: '/',
                            className: 'inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors'
                        }, 'æ·»åŠ å•è¯')
                    ]))
                ]);
            }

            return React.createElement('div', {
                className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100'
            }, [
                // å¯¼èˆªæ 
                React.createElement('nav', {
                    key: 'nav',
                    className: 'bg-white shadow-sm border-b'
                }, React.createElement('div', {
                    className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'
                }, React.createElement('div', {
                    className: 'flex justify-between h-16'
                }, React.createElement('div', {
                    className: 'flex items-center'
                }, [
                    React.createElement('h1', {
                        key: 'title',
                        className: 'text-xl font-semibold text-gray-800'
                    }, 'å•è¯ä»“åº“'),
                    React.createElement('div', {
                        key: 'links',
                        className: 'ml-10 flex items-baseline space-x-4'
                    }, [
                        React.createElement('a', {
                            key: 'home',
                            href: '/',
                            className: 'text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium'
                        }, 'é¦–é¡µ'),
                        React.createElement('a', {
                            key: 'manage',
                            href: '/manage',
                            className: 'text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium'
                        }, 'è¯æ±‡ç®¡ç†'),
                        React.createElement('a', {
                            key: 'review',
                            href: '/review',
                            className: 'bg-blue-100 text-blue-700 px-3 py-2 rounded-md text-sm font-medium'
                        }, 'å¤ä¹ ')
                    ])
                ])))),
                
                // è¿›åº¦æ¡
                React.createElement('div', {
                    key: 'progress',
                    className: 'w-full bg-gray-200 h-2'
                }, React.createElement('div', {
                    className: 'bg-blue-600 h-2 transition-all duration-300',
                    style: { width: `${progress}%` }
                })),
                
                // ä¸»è¦å†…å®¹
                React.createElement('div', {
                    key: 'main',
                    className: 'max-w-4xl mx-auto p-8'
                }, [
                    // å¤´éƒ¨ä¿¡æ¯
                    React.createElement('div', {
                        key: 'header',
                        className: 'text-center mb-8'
                    }, [
                        React.createElement('h1', {
                            key: 'title',
                            className: 'text-3xl font-bold text-gray-800 mb-2'
                        }, 'å¤ä¹ æ¨¡å¼'),
                        React.createElement('p', {
                            key: 'progress-text',
                            className: 'text-gray-600'
                        }, `${currentIndex + 1} / ${words.length}`)
                    ]),
                    
                    // å¤ä¹ å¡ç‰‡
                    React.createElement('div', {
                        key: 'card',
                        className: 'flex justify-center mb-8'
                    }, currentWord && React.createElement('div', {
                        className: 'bg-white rounded-xl shadow-lg p-8 max-w-md w-full mx-auto cursor-pointer transform hover:scale-105 transition-transform duration-200',
                        onClick: handleToggleTranslation
                    }, [
                        React.createElement('div', {
                            key: 'image',
                            className: 'mb-6'
                        }, [
                            currentWord.imageUrl ? 
                                React.createElement('img', {
                                    key: 'img',
                                    src: currentWord.imageUrl,
                                    alt: currentWord.word,
                                    className: 'w-full h-48 object-cover rounded-lg',
                                    onError: (e) => {
                                        e.target.style.display = 'none';
                                    }
                                }) :
                                React.createElement('div', {
                                    key: 'placeholder',
                                    className: 'w-full h-48 bg-gray-200 rounded-lg flex items-center justify-center'
                                }, React.createElement('span', { className: 'text-gray-500' }, 'æš‚æ— å›¾ç‰‡'))
                        ]),
                        React.createElement('div', {
                            key: 'content',
                            className: 'text-center'
                        }, [
                            React.createElement('h2', {
                                key: 'word',
                                className: 'text-3xl font-bold text-gray-800 mb-4'
                            }, currentWord.word),
                            showTranslation && React.createElement('p', {
                                key: 'translation',
                                className: 'text-xl text-blue-600 mb-2'
                            }, currentWord.translation),
                            currentWord.example && showTranslation && React.createElement('p', {
                                key: 'example',
                                className: 'text-sm text-gray-600 italic'
                            }, currentWord.example)
                        ])
                    ])),
                    
                    // æ§åˆ¶æŒ‰é’®
                    React.createElement('div', {
                        key: 'controls',
                        className: 'flex justify-center items-center space-x-4'
                    }, [
                        React.createElement('button', {
                            key: 'prev',
                            onClick: handlePrevious,
                            disabled: currentIndex === 0,
                            className: 'flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors'
                        }, [
                            React.createElement('span', { key: 'icon', className: 'mr-2' }, 'â†'),
                            'ä¸Šä¸€ä¸ª'
                        ]),
                        React.createElement('button', {
                            key: 'toggle',
                            onClick: handleToggleTranslation,
                            className: 'flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors'
                        }, [
                            React.createElement('span', { key: 'icon', className: 'mr-2' }, 'ğŸ”Š'),
                            showTranslation ? 'éšè—ç¿»è¯‘' : 'æ˜¾ç¤ºç¿»è¯‘'
                        ]),
                        React.createElement('button', {
                            key: 'next',
                            onClick: handleNext,
                            disabled: currentIndex === words.length - 1,
                            className: 'flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors'
                        }, [
                            'ä¸‹ä¸€ä¸ª',
                            React.createElement('span', { key: 'icon', className: 'ml-2' }, 'â†’')
                        ])
                    ]),
                    
                    // é‡æ–°å¼€å§‹æŒ‰é’®
                    React.createElement('div', {
                        key: 'restart',
                        className: 'text-center mt-8'
                    }, React.createElement('button', {
                        onClick: handleRestart,
                        className: 'flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors mx-auto'
                    }, [
                        React.createElement('span', { key: 'icon', className: 'mr-2' }, 'ğŸ”„'),
                        'é‡æ–°å¼€å§‹'
                    ]))
                ])
            ]);
        };

        // ä½¿ç”¨ createRoot è€Œä¸æ˜¯ ReactDOM.render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(ReviewPage));
    </script>
</body>
</html><!-- ä¿®å¤æ•°æ®åº“è®¿é—®: 1758375783 -->
